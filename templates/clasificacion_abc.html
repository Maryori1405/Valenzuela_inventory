{% extends 'base.html' %}

{% block title %}Clasificación ABC{% endblock %}

{% block content %}
<h1 class="text-3xl font-semibold mb-6">Clasificación ABC de Productos</h1>

<!-- Gráfico de líneas ABC -->
<div class="bg-white p-6 rounded-xl shadow-md mb-6">
  <h2 class="text-lg font-semibold text-gray-700 text-center mb-4 flex justify-center items-center gap-2">
    <i data-lucide="line-chart" class="w-5 h-5 text-[var(--accent)]"></i>
    Comparativa de Clasificación ABC
  </h2>
  <canvas id="graficoABC" height="180"></canvas>
</div>

<!-- Tabla ABC -->
<table class="w-full text-center border-collapse bg-[#FFFDF6] shadow-md rounded-xl overflow-hidden border border-[#E0DACC]">
  <thead class="bg-[#F2ECE5]">
    <tr>
      <th class="px-4 py-3 border">Nombre</th>
      <th class="px-4 py-3 border">Categoría</th>
      <th class="px-4 py-3 border">Total Salidas</th>
      <th class="px-4 py-3 border">Valor Consumido (S/)</th>
      <th class="px-4 py-3 border">Clasificación</th>
    </tr>
  </thead>
  <tbody>
    {% for p in productos %}
    <tr class="hover:bg-[#FAF7F2] transition duration-150">
      <td class="px-4 py-2 border">{{ p.nombre }}</td>
      <td class="px-4 py-2 border">{{ p.categoria }}</td>
      <td class="px-4 py-2 border">{{ p.total_salidas or 0 }}</td>
      <td class="px-4 py-2 border">S/ {{ '%.2f'|format(p.valor_consumido or 0) }}</td>
      <td class="px-4 py-2 border font-semibold">
        {% if p.clasificacion == 'A' %}
          <span class="text-red-600">A</span>
        {% elif p.clasificacion == 'B' %}
          <span class="text-yellow-600">B</span>
        {% else %}
          <span class="text-green-600">C</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctxABC = document.getElementById('graficoABC').getContext('2d');
  new Chart(ctxABC, {
    type: 'line',
    data: {
      labels: ['Clasificación A', 'Clasificación B', 'Clasificación C'],
      datasets: [{
        label: 'Cantidad de Productos',
        data: [
          {{ abc_counts['A'] }},
          {{ abc_counts['B'] }},
          {{ abc_counts['C'] }}
        ],
        fill: true,
        backgroundColor: 'rgba(59, 130, 246, 0.15)',
        borderColor: '#3b82f6',
        tension: 0.4,
        pointBackgroundColor: ['#f87171', '#facc15', '#22c55e'],
        pointRadius: 5,
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.label}: ${context.raw} productos`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Cantidad'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Clasificación'
          }
        }
      }
    }
  });

  lucide.createIcons();
</script>
{% endblock %}
